<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="BA_MobileGPS.Core.Views.MyVideoTab"
    xmlns="http://xamarin.com/schemas/2014/forms"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converter="clr-namespace:BA_MobileGPS.Core"
    xmlns:ff="clr-namespace:FFImageLoading.Forms;assembly=FFImageLoading.Forms"
    xmlns:ffsvg="clr-namespace:FFImageLoading.Svg.Forms;assembly=FFImageLoading.Svg.Forms"
    xmlns:icons="clr-namespace:BA_MobileGPS.Core.Controls"
    xmlns:indicator="clr-namespace:Syncfusion.SfBusyIndicator.XForms;assembly=Syncfusion.SfBusyIndicator.XForms"
    xmlns:pancake="clr-namespace:Xamarin.Forms.PancakeView;assembly=Xamarin.Forms.PancakeView"
    xmlns:prism="http://prismlibrary.com"
    xmlns:vlc="clr-namespace:LibVLCSharp.Forms.Shared;assembly=LibVLCSharp.Forms"
    xmlns:xforms="clr-namespace:Syncfusion.ListView.XForms;assembly=Syncfusion.SfListView.XForms"
    x:Name="root"
    prism:ViewModelLocator.AutowireViewModel="True">
    <ContentPage.Resources>
        <Style TargetType="indicator:SfBusyIndicator">
            <Setter Property="AnimationType" Value="Cupertino" />
            <Setter Property="BackgroundColor" Value="Transparent" />
            <Setter Property="EnableAnimation" Value="True" />
            <Setter Property="TextColor" Value="White" />
            <Setter Property="ViewBoxHeight" Value="35" />
            <Setter Property="ViewBoxWidth" Value="35" />
            <Setter Property="Duration" Value="0.8" />
        </Style>
        <converter:DateTimeViewConverter x:Key="DateTimeViewConverter" />
    </ContentPage.Resources>
    <ContentPage.Content>
        <!--  Khu vực video và danh sách  -->
        <Grid
            x:Name="mainLayout"
            Grid.Row="1"
            RowDefinitions="Auto,Auto,*"
            RowSpacing="0">
            <Grid.Triggers>
                <DataTrigger
                    Binding="{Binding IsFullScreenOff}"
                    TargetType="Grid"
                    Value="false">
                    <Setter Property="RowDefinitions" Value="Auto,0,*" />
                </DataTrigger>
            </Grid.Triggers>
            <!--  // Height set ở code  -->
            <Grid
                x:Name="mainTopLayout"
                Grid.Row="0"
                RowDefinitions="*,Auto,1"
                RowSpacing="0">
                <!--  Video  -->
                <pancake:PancakeView BackgroundColor="{DynamicResource BlackColor}" HeightRequest="250">
                    <Grid>
                        <vlc:MediaPlayerElement
                            HorizontalOptions="Fill"
                            LibVLC="{Binding LibVLC}"
                            MediaPlayer="{Binding MediaPlayer}"
                            VerticalOptions="Fill" />

                        <indicator:SfBusyIndicator
                            Title="Video đang load trực tiếp từ thiết bị. Vui lòng chờ trong giây lát."
                            IsBusy="{Binding BusyIndicatorActive}"
                            TextColor="{DynamicResource WhiteColor}"
                            TextSize="10" />

                        <Grid
                            x:Name="errGrid"
                            BackgroundColor="{DynamicResource BlackColor}"
                            IsVisible="{Binding IsError}">
                            <StackLayout HorizontalOptions="Center" VerticalOptions="Center">
                                <icons:IconView
                                    Foreground="{DynamicResource WhiteColor}"
                                    HeightRequest="25"
                                    Source="ic_reload"
                                    WidthRequest="25" />
                                <Label
                                    Margin="30,0"
                                    FontSize="10"
                                    HorizontalOptions="Center"
                                    HorizontalTextAlignment="Center"
                                    LineBreakMode="WordWrap"
                                    Text="{Binding ErrorMessenger}"
                                    TextColor="{DynamicResource WhiteColor}" />
                                <StackLayout.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding ReLoadCommand}" />
                                </StackLayout.GestureRecognizers>
                            </StackLayout>
                        </Grid>
                    </Grid>
                </pancake:PancakeView>

                <!--  Chi tiết video được chọn  -->
                <StackLayout
                    Grid.Row="1"
                    Padding="10,0,0,5"
                    BackgroundColor="#3D3D3D"
                    IsVisible="{Binding IsFullScreenOff}"
                    Spacing="3">
                    <Label
                        HorizontalOptions="Start"
                        StyleClass="BoldText"
                        Text="Video_20201020_122320"
                        TextColor="{DynamicResource WhiteColor}" />
                    <Label
                        HorizontalOptions="Start"
                        Text="00:02 09/09/2020"
                        TextColor="{DynamicResource WhiteColor}" />

                </StackLayout>
            </Grid>

            <!--  Tự động phát  -->
            <StackLayout
                Grid.Row="1"
                Padding="5,0"
                Orientation="Horizontal">
                <Label
                    StyleClass="BoldText"
                    Text="Danh sách video"
                    VerticalOptions="Center" />
            </StackLayout>

            <!--  Danh sách video  -->
            <icons:HorizontalList
                x:Name="listview"
                Grid.Row="2"
                Padding="5,0"
                ItemsSource="{Binding VideoItemsSource, Mode=OneWay}"
                SelectedItem="{Binding VideoSlected}"
                Spacing="10">
                <icons:HorizontalList.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <pancake:PancakeView Padding="0" HeightRequest="270">
                                <pancake:PancakeView.Shadow>
                                    <pancake:DropShadow
                                        BlurRadius="1"
                                        Offset="3,0"
                                        Color="Black" />
                                </pancake:PancakeView.Shadow>
                                <Grid
                                    BackgroundColor="Transparent"
                                    RowDefinitions="*,Auto"
                                    RowSpacing="0">
                                    <Grid
                                        Padding="2"
                                        BackgroundColor="Black"
                                        HeightRequest="250"
                                        VerticalOptions="FillAndExpand">
                                        <ff:CachedImage Aspect="Fill" Source="bg_driver_header.png" />
                                        <icons:IconView
                                            Foreground="{DynamicResource WhiteColor}"
                                            HeightRequest="30"
                                            HorizontalOptions="Center"
                                            Source="ic_play"
                                            VerticalOptions="Center" />
                                        <Label
                                            Margin="0,0,10,10"
                                            HorizontalOptions="End"
                                            Text="{Binding VideoTime}"
                                            TextColor="{DynamicResource WhiteColor}"
                                            VerticalOptions="End" />
                                    </Grid>

                                    <StackLayout
                                        Grid.Row="1"
                                        Padding="10,5"
                                        VerticalOptions="End">
                                        <Label
                                            HorizontalOptions="Start"
                                            StyleClass="BoldText"
                                            Text="{Binding StartTime, Converter={StaticResource DateTimeViewConverter}}" />
                                        <Label
                                            HorizontalOptions="Start"
                                            StyleClass="BoldText"
                                            Text="Kênh 1" />
                                    </StackLayout>
                                </Grid>
                            </pancake:PancakeView>
                        </Grid>
                    </DataTemplate>
                </icons:HorizontalList.ItemTemplate>
            </icons:HorizontalList>

            <StackLayout
                Grid.Row="2"
                BackgroundColor="Transparent"
                HorizontalOptions="Center"
                IsVisible="{Binding VideoItemsSource, Converter={StaticResource IsEmptyDataConverter}}"
                Spacing="10"
                VerticalOptions="Center">
                <ffsvg:SvgCachedImage
                    BackgroundColor="Transparent"
                    HeightRequest="200"
                    Source="NoPhotos.svg"
                    VerticalOptions="Center"
                    WidthRequest="200" />
                <Label
                    Text="Không có dữ liệu video"
                    TextColor="{DynamicResource TextPrimaryColor}"
                    VerticalTextAlignment="Center" />
            </StackLayout>
        </Grid>
    </ContentPage.Content>
</ContentPage>